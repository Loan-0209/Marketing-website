<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>AI Campus 3D - Professional Master Plan Architecture</title>
    
    <!-- Three.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <!-- Master Plan 3D - Professional Architecture -->
    <script src="../js/master-plan-3d.js"></script>
    
    <style>
        /* Reset CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Main Styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #ffffff;
            height: 100vh;
            width: 100vw;
        }
        
        /* Master Plan 3D Container */
        #threejs-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB, #E0F6FF);
        }
        
        /* Loading Overlay - Master Plan Compatible */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 15, 30, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.5s;
            backdrop-filter: blur(10px);
        }
        
        .loading-text {
            font-size: 24px;
            margin-bottom: 20px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(79, 195, 247, 0.3);
            border-radius: 50%;
            border-top-color: #4fc3f7;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* Control Panel */
        #control-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        #control-panel h3 {
            margin-bottom: 10px;
            font-size: 16px;
            color: #4fc3f7;
            text-align: center;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .btn {
            background-color: rgba(79, 195, 247, 0.2);
            color: #ffffff;
            border: 1px solid #4fc3f7;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            outline: none;
        }
        
        .btn:hover {
            background-color: rgba(79, 195, 247, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(79, 195, 247, 0.5);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(79, 195, 247, 0.5);
        }
        
        /* Stats Panel */
        #stats-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            min-width: 150px;
        }
        
        #stats-panel h3 {
            margin-bottom: 10px;
            font-size: 16px;
            color: #4fc3f7;
            text-align: center;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .stat-value {
            color: #4fc3f7;
            font-weight: bold;
        }
        
        /* Info Panel */
        #info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            max-width: 300px;
        }
        
        #info-panel h3 {
            margin-bottom: 10px;
            font-size: 16px;
            color: #4fc3f7;
            text-align: center;
        }
        
        #info-panel p {
            font-size: 14px;
            margin-bottom: 5px;
        }

        /* Timeline Controls for Master Plan */
        .timeline-controls {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .timeline-item {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 2px solid #4fc3f7;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .timeline-item:hover {
            background: rgba(79, 195, 247, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 195, 247, 0.4);
        }

        .timeline-item.active {
            background: #4fc3f7;
            color: #1a1a1a;
            font-weight: 700;
        }

        /* View Controls */
        .view-controls {
            position: absolute;
            top: 140px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
        }

        .control-btn[data-view] {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 1px solid #4fc3f7;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            min-width: 100px;
        }

        .control-btn[data-view]:hover {
            background: rgba(79, 195, 247, 0.3);
            transform: translateX(-2px);
        }

        .control-btn[data-view].active {
            background: #4fc3f7;
            color: #1a1a1a;
        }

        /* Performance Indicator */
        .performance-indicator {
            position: absolute;
            top: 100px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #10b981;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            font-weight: bold;
            backdrop-filter: blur(10px);
            border: 1px solid #10b981;
            z-index: 100;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            #control-panel, #stats-panel, #info-panel {
                padding: 10px;
            }
            
            .control-buttons {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 10px;
                font-size: 16px;
            }
            
            #stats-panel {
                top: auto;
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Master Plan 3D Container -->
    <div id="threejs-container"></div>
    
    <!-- Loading Overlay - Master Plan Compatible -->
    <div id="loadingOverlay">
        <div class="loading-text">üèóÔ∏è ƒêang t·∫£i Professional AI Campus Architecture...</div>
        <div class="spinner"></div>
        <div style="margin-top: 15px; font-size: 14px; color: #4fc3f7;">
            Master Plan 3D - High Performance Version
        </div>
    </div>
    
    <!-- Timeline Controls for Phase Management -->
    <div class="timeline-controls">
        <div class="timeline-item active" data-phase="phase1">Phase 1: Foundation</div>
        <div class="timeline-item" data-phase="phase2">Phase 2: Expansion</div>
        <div class="timeline-item" data-phase="phase3">Phase 3: Integration</div>
    </div>

    <!-- View Controls -->
    <div class="view-controls">
        <button class="control-btn active" data-view="overview">Overview</button>
        <button class="control-btn" data-view="aerial">Aerial View</button>
        <button class="control-btn" data-view="ground">Ground Level</button>
    </div>

    <!-- Performance Indicator -->
    <div class="performance-indicator">60 FPS</div>
    
    <!-- Stats Panel -->
    <div id="stats-panel">
        <h3>Th·ªëng k√™</h3>
        <div class="stat-item">
            <span>FPS:</span>
            <span class="stat-value" id="fps-counter">0</span>
        </div>
        <div class="stat-item">
            <span>Objects:</span>
            <span class="stat-value" id="objects-counter">0</span>
        </div>
        <div class="stat-item">
            <span>Triangles:</span>
            <span class="stat-value" id="triangles-counter">0</span>
        </div>
    </div>
    
    <!-- Info Panel -->
    <div id="info-panel">
        <h3>AI Campus 3D</h3>
        <p>üèôÔ∏è Khu C√¥ng Ngh·ªá Cao AI Campus</p>
        <p>üñ±Ô∏è K√©o chu·ªôt ƒë·ªÉ xoay camera</p>
        <p>üñ≤Ô∏è Cu·ªôn chu·ªôt ƒë·ªÉ zoom in/out</p>
        <p>üì± Vu·ªët m√†n h√¨nh ƒë·ªÉ ƒëi·ªÅu khi·ªÉn tr√™n thi·∫øt b·ªã di ƒë·ªông</p>
    </div>
    
    <!-- Master Plan 3D Integration -->
    <script>
        // Master Plan 3D Instance
        let masterPlanInstance = null;
        let isInitialized = false;
        
        // Initialize Master Plan 3D
        async function initializeMasterPlan() {
            try {
                console.log('üöÄ Initializing Master Plan 3D Professional Architecture...');
                
                // Check if MasterPlan3D class is available
                if (typeof MasterPlan3D === 'undefined') {
                    throw new Error('MasterPlan3D class not found. Check if js/master-plan-3d.js is loaded.');
                }
                
                // Create Master Plan instance
                masterPlanInstance = new MasterPlan3D();
                
                // Initialize the master plan
                await masterPlanInstance.init();
                
                console.log('‚úÖ Master Plan 3D initialized successfully');
                isInitialized = true;
                
                // Setup additional event listeners for UI integration
                setupUIIntegration();
                
            } catch (error) {
                console.error('‚ùå Failed to initialize Master Plan 3D:', error);
                showErrorMessage('Kh√¥ng th·ªÉ kh·ªüi t·∫°o 3D Campus: ' + error.message);
            }
        }
        
        // Setup UI Integration with Master Plan
        function setupUIIntegration() {
            // Timeline phase controls
            document.querySelectorAll('.timeline-item').forEach(item => {
                item.addEventListener('click', function() {
                    const phase = this.dataset.phase;
                    
                    // Update active state
                    document.querySelectorAll('.timeline-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update master plan phase
                    if (masterPlanInstance && masterPlanInstance.updatePhaseVisibility) {
                        masterPlanInstance.updatePhaseVisibility(phase);
                        console.log('üîÑ Switched to', phase);
                    }
                });
            });
            
            // View controls
            document.querySelectorAll('.control-btn[data-view]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const view = this.dataset.view;
                    
                    // Update active state
                    document.querySelectorAll('.control-btn[data-view]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update master plan camera view
                    if (masterPlanInstance && masterPlanInstance.setCameraView) {
                        masterPlanInstance.setCameraView(view);
                        console.log('üì∑ Switched to', view, 'view');
                    }
                });
            });
        }
        
        // Error display function
        function showErrorMessage(message) {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.innerHTML = `
                    <div style="color: #ff6b6b; text-align: center; background: rgba(0,0,0,0.9); padding: 30px; border-radius: 15px;">
                        <div style="font-size: 24px; margin-bottom: 15px;">‚ö†Ô∏è L·ªói Kh·ªüi T·∫°o</div>
                        <div style="font-size: 16px; margin-bottom: 15px;">${message}</div>
                        <div style="font-size: 14px; color: #ccc;">
                            Ki·ªÉm tra Console (F12) ƒë·ªÉ xem chi ti·∫øt<br>
                            Refresh trang ƒë·ªÉ th·ª≠ l·∫°i
                        </div>
                    </div>
                `;
            }
        }
        
        
        // WebGL compatibility check
        function checkWebGLSupport() {
            if (!window.WebGLRenderingContext) {
                showErrorMessage('Browser kh√¥ng support WebGL');
                return false;
            }
            
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            
            if (!gl) {
                showErrorMessage('WebGL context kh√¥ng th·ªÉ t·∫°o');
                return false;
            }
            
            console.log('‚úÖ WebGL supported -', gl.getParameter(gl.RENDERER));
            return true;
        }
        
        // Main initialization
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üåü DOM loaded, starting Master Plan 3D initialization...');
            
            try {
                // Check WebGL support
                if (!checkWebGLSupport()) {
                    return;
                }
                
                // Check Three.js availability
                if (typeof THREE === 'undefined') {
                    throw new Error('Three.js library not loaded');
                }
                
                // Check Master Plan 3D class
                if (typeof MasterPlan3D === 'undefined') {
                    throw new Error('MasterPlan3D class not loaded. Check js/master-plan-3d.js file.');
                }
                
                console.log('üìö Dependencies loaded successfully');
                console.log('üéØ Three.js version:', THREE.REVISION);
                
                // Initialize Master Plan with delay for smooth loading
                setTimeout(async () => {
                    await initializeMasterPlan();
                }, 500);
                
            } catch (error) {
                console.error('‚ùå Initialization failed:', error);
                showErrorMessage('L·ªói kh·ªüi t·∫°o: ' + error.message);
            }
        });
        
        // Handle errors
        window.addEventListener('error', function(event) {
            console.error('‚ùå Runtime error:', event.error);
            if (!isInitialized) {
                showErrorMessage('L·ªói runtime: ' + event.message);
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (masterPlanInstance && masterPlanInstance.handleResize) {
                masterPlanInstance.handleResize();
            }
        });
    </script>
</body>
</html>

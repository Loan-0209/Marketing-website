<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Loading Bypass - 3D Smart City</title>
    <style>
        /* CRITICAL: Force hide any loading screen immediately */
        #loading-screen {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        /* Force show canvas container */
        #canvas-container {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 1 !important;
            background: linear-gradient(135deg, #87CEEB 0%, #98D8E8 50%, #B0E0E6 100%) !important;
        }

        #canvas-container canvas {
            display: block !important;
            width: 100% !important;
            height: 100% !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #87CEEB;
        }

        /* Emergency status */
        #emergency-status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 9999;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="emergency-status">🚀 Emergency Loading Bypass Active</div>
    <div id="canvas-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        console.log('🚨 EMERGENCY LOADING BYPASS ACTIVATED');

        // IMMEDIATE: Kill any existing loading screens
        setTimeout(() => {
            const loadingScreens = document.querySelectorAll('[id*="loading"], [class*="loading"]');
            loadingScreens.forEach(screen => {
                screen.style.display = 'none';
                screen.style.visibility = 'hidden';
                screen.style.opacity = '0';
                screen.remove();
            });
        }, 100);

        // SIMPLE 3D SCENE - NO LOADING DELAYS
        let scene, camera, renderer;

        function initEmergencyScene() {
            console.log('🔧 Creating emergency 3D scene...');

            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            // Camera  
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(50, 50, 50);
            camera.lookAt(0, 0, 0);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;

            // FORCE canvas styling immediately
            const canvas = renderer.domElement;
            canvas.style.cssText = `
                display: block !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                visibility: visible !important;
                opacity: 1 !important;
            `;

            const container = document.getElementById('canvas-container');
            container.appendChild(canvas);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Ground
            const groundGeometry = new THREE.PlaneGeometry(200, 200);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x90EE90 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = 0;
            scene.add(ground);

            // Quick city
            createEmergencyCity();

            // Start render immediately
            console.log('🎬 Starting emergency render loop...');
            animate();

            // Update status
            document.getElementById('emergency-status').textContent = '✅ Emergency Scene Active - 3D City Running';
        }

        function createEmergencyCity() {
            // Create simple buildings quickly
            const colors = [0x8B7355, 0xA0A0A0, 0x6B8E23, 0x4682B4, 0x8B4513];
            
            for (let x = -80; x <= 80; x += 25) {
                for (let z = -80; z <= 80; z += 25) {
                    if (Math.random() > 0.3) {
                        const height = 10 + Math.random() * 30;
                        const geometry = new THREE.BoxGeometry(8, height, 8);
                        const material = new THREE.MeshLambertMaterial({
                            color: colors[Math.floor(Math.random() * colors.length)]
                        });
                        const building = new THREE.Mesh(geometry, material);
                        building.position.set(x, height/2, z);
                        building.castShadow = true;
                        scene.add(building);
                    }
                }
            }

            // Add some trees
            for (let i = 0; i < 20; i++) {
                const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.8, 6);
                const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);

                const foliageGeometry = new THREE.SphereGeometry(3);
                const foliageMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
                const foliage = new THREE.Mesh(foliageGeometry, foliageMaterial);

                const x = (Math.random() - 0.5) * 160;
                const z = (Math.random() - 0.5) * 160;

                trunk.position.set(x, 3, z);
                foliage.position.set(x, 8, z);

                scene.add(trunk);
                scene.add(foliage);
            }
        }

        // Simple controls
        let mouseX = 0, mouseY = 0;
        let isMouseDown = false;

        document.addEventListener('mousedown', () => { isMouseDown = true; });
        document.addEventListener('mouseup', () => { isMouseDown = false; });
        document.addEventListener('mousemove', (event) => {
            if (isMouseDown) {
                const deltaX = event.clientX - mouseX;
                const deltaY = event.clientY - mouseY;
                
                camera.position.x -= deltaX * 0.1;
                camera.position.z -= deltaY * 0.1;
                camera.lookAt(0, 0, 0);
            }
            mouseX = event.clientX;
            mouseY = event.clientY;
        });

        document.addEventListener('wheel', (event) => {
            const factor = event.deltaY > 0 ? 1.1 : 0.9;
            camera.position.multiplyScalar(factor);
            camera.lookAt(0, 0, 0);
        });

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        window.addEventListener('resize', onWindowResize);

        // CRITICAL: Initialize immediately when THREE.js loads
        if (typeof THREE !== 'undefined') {
            console.log('✅ THREE.js available, initializing immediately...');
            initEmergencyScene();
        } else {
            console.log('⏳ Waiting for THREE.js...');
            let attempts = 0;
            const checkThree = setInterval(() => {
                attempts++;
                if (typeof THREE !== 'undefined') {
                    clearInterval(checkThree);
                    console.log('✅ THREE.js loaded, initializing...');
                    initEmergencyScene();
                } else if (attempts > 50) {
                    clearInterval(checkThree);
                    console.error('❌ THREE.js failed to load');
                    document.getElementById('emergency-status').innerHTML = '❌ THREE.js Load Failed';
                }
            }, 100);
        }

        // Emergency debug functions
        window.emergencyDebug = function() {
            console.log('🔍 Emergency Debug:');
            console.log('- Scene:', !!scene);
            console.log('- Camera:', !!camera);  
            console.log('- Renderer:', !!renderer);
            console.log('- Canvas:', !!renderer?.domElement);
            console.log('- Canvas visible:', renderer?.domElement?.offsetHeight > 0);
        };

        // Force render every second as backup
        setInterval(() => {
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }, 1000);

        console.log('🚀 Emergency bypass script loaded successfully');
    </script>
</body>
</html>
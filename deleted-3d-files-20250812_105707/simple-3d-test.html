<!DOCTYPE html>
<html>
<head>
    <title>Simple 3D Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { 
            margin: 0; 
            background: #001122; 
            font-family: monospace; 
            overflow: hidden;
        }
        #loading { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            color: white; 
            font-size: 18px;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        #info {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="loading">üîÑ Loading 3D Scene...</div>
    <div id="info">
        <div>Status: <span id="status">Starting...</span></div>
        <div>Objects: <span id="objects">0</span></div>
        <div>Time: <span id="time">0s</span></div>
    </div>

    <script>
        const startTime = Date.now();
        const loading = document.getElementById('loading');
        const statusEl = document.getElementById('status');
        const objectsEl = document.getElementById('objects');
        const timeEl = document.getElementById('time');
        
        function updateStatus(msg) {
            console.log(msg);
            statusEl.textContent = msg;
            loading.textContent = `üîÑ ${msg}`;
            
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
            timeEl.textContent = elapsed + 's';
        }
        
        function hideLoading() {
            loading.style.display = 'none';
            console.log('‚úÖ Loading hidden');
        }
        
        // Step 1: Check Three.js
        updateStatus('Checking Three.js...');
        
        setTimeout(() => {
            if (typeof THREE === 'undefined') {
                updateStatus('‚ùå THREE.js failed to load');
                loading.style.color = '#ff0000';
                return;
            }
            
            updateStatus('‚úÖ THREE.js loaded');
            
            // Step 2: Create scene
            updateStatus('Creating scene...');
            
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x001122);
            scene.fog = new THREE.Fog(0x001122, 50, 200);
            
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(50, 30, 50);
            camera.lookAt(0, 0, 0);
            
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);
            
            updateStatus('‚úÖ Scene created');
            
            // Step 3: Add lighting
            updateStatus('Adding lights...');
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
            directionalLight.position.set(100, 100, 50);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            updateStatus('‚úÖ Lights added');
            
            // Step 4: Create buildings
            updateStatus('Creating buildings...');
            
            const buildingColors = [0x4a90e2, 0x7f8c8d, 0x2c3e50, 0x34495e, 0x5dade2];
            let buildingCount = 0;
            
            for (let x = -100; x <= 100; x += 25) {
                for (let z = -100; z <= 100; z += 25) {
                    if (Math.random() > 0.3 && buildingCount < 50) {
                        const height = 20 + Math.random() * 40;
                        const width = 4 + Math.random() * 4;
                        const depth = 4 + Math.random() * 4;
                        
                        const geometry = new THREE.BoxGeometry(width, height, depth);
                        const material = new THREE.MeshLambertMaterial({
                            color: buildingColors[Math.floor(Math.random() * buildingColors.length)]
                        });
                        
                        const building = new THREE.Mesh(geometry, material);
                        building.position.set(x, height/2, z);
                        building.castShadow = true;
                        building.receiveShadow = true;
                        
                        scene.add(building);
                        buildingCount++;
                    }
                }
                if (buildingCount >= 50) break;
            }
            
            objectsEl.textContent = scene.children.length;
            updateStatus(`‚úÖ ${buildingCount} buildings created`);
            
            // Step 5: Add ground
            updateStatus('Adding ground...');
            
            const groundGeometry = new THREE.PlaneGeometry(300, 300);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x2d5a27 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            updateStatus('‚úÖ Ground added');
            
            // Step 6: Setup controls
            updateStatus('Setting up controls...');
            
            let controls;
            if (typeof THREE.OrbitControls !== 'undefined') {
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                updateStatus('‚úÖ OrbitControls enabled');
            } else {
                updateStatus('‚ö†Ô∏è OrbitControls not available');
            }
            
            // Step 7: Start animation
            updateStatus('Starting animation...');
            
            function animate() {
                requestAnimationFrame(animate);
                
                if (controls) {
                    controls.update();
                }
                
                renderer.render(scene, camera);
            }
            
            animate();
            updateStatus('‚úÖ Animation started');
            
            // Step 8: Hide loading
            setTimeout(() => {
                hideLoading();
                updateStatus('üéâ Ready!');
            }, 1000);
            
            // Window resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
        }, 1000);
    </script>
</body>
</html>
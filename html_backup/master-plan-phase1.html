<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Plan 3D - Phase 1 Professional</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #1e3a8a;
            --light-blue: #3b82f6;
            --primary-yellow: #fbbf24;
            --white: #ffffff;
            --dark-blue: #1e2148;
            --gray: #6b7280;
            --success: #10b981;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient-primary);
            color: var(--dark-blue);
            overflow-x: hidden;
        }

        /* Professional Navigation */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(30, 58, 138, 0.98);
            backdrop-filter: blur(20px);
            z-index: 9999;
            padding: 1rem 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-yellow);
            text-decoration: none;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-link {
            color: var(--white);
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--primary-yellow);
            color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }

        /* Main Layout */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 420px;
            height: 100vh;
            padding-top: 80px;
        }

        /* 3D Viewer Container */
        .viewer-container {
            position: relative;
            background: var(--gradient-primary);
            overflow: hidden;
            border-radius: 0 20px 0 0;
        }

        #threejs-container {
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        #threejs-container:active {
            cursor: grabbing;
        }

        /* Professional Controls */
        .viewer-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 12px;
            z-index: 100;
            flex-wrap: wrap;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-blue);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            user-select: none;
            min-width: 100px;
            text-align: center;
        }

        .control-btn:hover {
            background: var(--primary-yellow);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(251, 191, 36, 0.4);
        }

        .control-btn.active {
            background: var(--primary-yellow);
            color: var(--white);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.5);
        }

        /* Lighting Controls */
        .lighting-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .lighting-controls h4 {
            margin-bottom: 12px;
            color: var(--primary-blue);
            font-weight: 600;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .slider-container label {
            font-size: 12px;
            color: var(--gray);
            min-width: 60px;
        }

        .slider {
            -webkit-appearance: none;
            width: 120px;
            height: 4px;
            border-radius: 2px;
            background: #ddd;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary-yellow);
            cursor: pointer;
        }

        /* Timeline Panel */
        .timeline-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 2rem;
            overflow-y: auto;
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.1);
        }

        .panel-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 2rem;
            text-align: center;
            background: var(--gradient-secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Professional Timeline */
        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 18px;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--gradient-secondary);
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 3rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .timeline-item:hover {
            transform: translateX(16px);
        }

        .timeline-item.active {
            transform: translateX(20px);
        }

        .timeline-marker {
            position: absolute;
            left: -40px;
            top: 12px;
            width: 24px;
            height: 24px;
            background: var(--white);
            border: 4px solid var(--primary-yellow);
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .timeline-item:hover .timeline-marker,
        .timeline-item.active .timeline-marker {
            background: var(--primary-yellow);
            transform: scale(1.3);
            box-shadow: 0 0 24px rgba(251, 191, 36, 0.6);
            border-color: var(--white);
        }

        .timeline-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            padding: 2rem;
            border-radius: 20px;
            border: 2px solid transparent;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .timeline-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-secondary);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .timeline-item:hover .timeline-card,
        .timeline-item.active .timeline-card {
            border-color: var(--primary-yellow);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.15);
            transform: translateY(-4px);
        }

        .timeline-item:hover .timeline-card::before,
        .timeline-item.active .timeline-card::before {
            transform: scaleX(1);
        }

        /* Professional Performance Indicator */
        .performance-indicator {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            color: var(--success);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .phase-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
        }

        .phase-period {
            font-size: 1rem;
            color: var(--light-blue);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .phase-description {
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
            color: var(--gray);
        }

        .phase-features {
            list-style: none;
            margin: 0;
        }

        .phase-features li {
            position: relative;
            padding-left: 32px;
            font-size: 0.95rem;
            color: var(--dark-blue);
            margin-bottom: 0.5rem;
        }

        .phase-features li::before {
            content: '✓';
            position: absolute;
            left: 0;
            top: 0;
            color: var(--success);
            font-weight: 700;
        }

        /* Loading States */
        #loadingOverlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.6s ease;
        }

        .loading-content {
            text-align: center;
            color: var(--white);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid var(--primary-yellow);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: 500;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: 60vh auto;
                height: auto;
            }
            .timeline-panel {
                padding: 1.5rem;
            }
            .lighting-controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">🚀 HEART</a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="master-plan.html" class="nav-link active">Master Plan</a></li>
                <li><a href="index.html#facilities" class="nav-link">Facilities</a></li>
                <li><a href="index.html#investment" class="nav-link">Investment</a></li>
                <li><a href="index.html#technology" class="nav-link">Technology</a></li>
                <li><a href="index.html#contact" class="nav-link">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- 3D Viewer -->
        <div class="viewer-container">
            <div id="loadingOverlay">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <p class="loading-text">Loading Professional Master Plan...</p>
                </div>
            </div>
            
            <!-- Professional Controls -->
            <div class="viewer-controls">
                <button class="control-btn active" data-view="overview">Overview</button>
                <button class="control-btn" data-view="aerial">Aerial</button>
                <button class="control-btn" data-view="ground">Ground</button>
                <button class="control-btn" data-action="auto-rotate">Auto Rotate</button>
                <button class="control-btn" data-action="day-night">Day/Night</button>
            </div>

            <!-- Lighting Controls -->
            <div class="lighting-controls">
                <h4>Lighting Controls</h4>
                <div class="slider-container">
                    <label>Sun:</label>
                    <input type="range" class="slider" id="sunIntensity" min="0" max="3" step="0.1" value="1.5">
                </div>
                <div class="slider-container">
                    <label>Ambient:</label>
                    <input type="range" class="slider" id="ambientIntensity" min="0" max="2" step="0.1" value="0.8">
                </div>
                <div class="slider-container">
                    <label>Time:</label>
                    <input type="range" class="slider" id="timeOfDay" min="0" max="24" step="0.5" value="12">
                </div>
            </div>
            
            <div class="performance-indicator" id="performanceIndicator">Loading...</div>
            
            <div id="threejs-container"></div>
        </div>

        <!-- Timeline Panel -->
        <div class="timeline-panel">
            <h2 class="panel-title">Development Timeline</h2>
            
            <div class="timeline">
                <div class="timeline-item active" data-phase="phase1">
                    <div class="timeline-marker"></div>
                    <div class="timeline-card">
                        <h3 class="phase-title">Phase 1: Foundation</h3>
                        <p class="phase-period">2025 - 2027</p>
                        <p class="phase-description">Infrastructure development and core facility construction</p>
                        <ul class="phase-features">
                            <li>Administration Center</li>
                            <li>Research & Development</li>
                            <li>Innovation Hub</li>
                            <li>Basic Infrastructure</li>
                        </ul>
                    </div>
                </div>

                <div class="timeline-item" data-phase="phase2">
                    <div class="timeline-marker"></div>
                    <div class="timeline-card">
                        <h3 class="phase-title">Phase 2: Expansion</h3>
                        <p class="phase-period">2027 - 2030</p>
                        <p class="phase-description">Technology sectors and business districts development</p>
                        <ul class="phase-features">
                            <li>Office Complexes</li>
                            <li>Manufacturing Facility</li>
                            <li>Conference Center</li>
                            <li>Transportation Hub</li>
                        </ul>
                    </div>
                </div>

                <div class="timeline-item" data-phase="phase3">
                    <div class="timeline-marker"></div>
                    <div class="timeline-card">
                        <h3 class="phase-title">Phase 3: Integration</h3>
                        <p class="phase-period">2030+</p>
                        <p class="phase-description">Smart city features and ecosystem completion</p>
                        <ul class="phase-features">
                            <li>Residential Complex</li>
                            <li>Energy Center</li>
                            <li>Smart Infrastructure</li>
                            <li>Green Systems</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        console.log('🚀 Starting Professional Master Plan Phase 1...');

        // Professional OrbitControls with smooth animations
        THREE.OrbitControls = function (object, domElement) {
            this.object = object;
            this.domElement = domElement || document;
            this.enabled = true;
            this.target = new THREE.Vector3();
            this.minDistance = 20;
            this.maxDistance = 400;
            this.enableDamping = true;
            this.dampingFactor = 0.05;
            this.enableZoom = true;
            this.enableRotate = true;
            this.enablePan = true;
            this.autoRotate = false;
            this.autoRotateSpeed = 1.0;
            
            var scope = this;
            var STATE = { NONE: -1, ROTATE: 0, DOLLY: 1, PAN: 2 };
            var state = STATE.NONE;
            var EPS = 0.000001;
            
            var spherical = new THREE.Spherical();
            var sphericalDelta = new THREE.Spherical();
            var scale = 1;
            var panOffset = new THREE.Vector3();
            
            var rotateStart = new THREE.Vector2();
            var rotateEnd = new THREE.Vector2();
            var rotateDelta = new THREE.Vector2();
            
            this.update = function () {
                var offset = new THREE.Vector3();
                var quat = new THREE.Quaternion().setFromUnitVectors(object.up, new THREE.Vector3(0, 1, 0));
                var quatInverse = quat.clone().inverse();
                
                return function update() {
                    var position = scope.object.position;
                    offset.copy(position).sub(scope.target);
                    offset.applyQuaternion(quat);
                    spherical.setFromVector3(offset);
                    
                    if (scope.autoRotate && state === STATE.NONE) {
                        sphericalDelta.theta -= 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;
                    }
                    
                    spherical.theta += sphericalDelta.theta;
                    spherical.phi += sphericalDelta.phi;
                    spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                    spherical.radius *= scale;
                    spherical.radius = Math.max(scope.minDistance, Math.min(scope.maxDistance, spherical.radius));
                    
                    scope.target.add(panOffset);
                    offset.setFromSpherical(spherical);
                    offset.applyQuaternion(quatInverse);
                    position.copy(scope.target).add(offset);
                    scope.object.lookAt(scope.target);
                    
                    if (scope.enableDamping === true) {
                        sphericalDelta.theta *= (1 - scope.dampingFactor);
                        sphericalDelta.phi *= (1 - scope.dampingFactor);
                        panOffset.multiplyScalar(1 - scope.dampingFactor);
                    } else {
                        sphericalDelta.set(0, 0, 0);
                        panOffset.set(0, 0, 0);
                    }
                    
                    scale = 1;
                    return true;
                };
            }();
            
            function onMouseDown(event) {
                if (scope.enabled === false) return;
                event.preventDefault();
                
                if (event.button === 0) {
                    state = STATE.ROTATE;
                    rotateStart.set(event.clientX, event.clientY);
                }
                
                scope.domElement.addEventListener('mousemove', onMouseMove, false);
                scope.domElement.addEventListener('mouseup', onMouseUp, false);
            }
            
            function onMouseMove(event) {
                if (scope.enabled === false) return;
                event.preventDefault();
                
                if (state === STATE.ROTATE) {
                    rotateEnd.set(event.clientX, event.clientY);
                    rotateDelta.subVectors(rotateEnd, rotateStart);
                    
                    var element = scope.domElement === document ? scope.domElement.body : scope.domElement;
                    sphericalDelta.theta -= 2 * Math.PI * rotateDelta.x / element.clientWidth;
                    sphericalDelta.phi -= 2 * Math.PI * rotateDelta.y / element.clientHeight;
                    
                    rotateStart.copy(rotateEnd);
                    scope.update();
                }
            }
            
            function onMouseUp() {
                scope.domElement.removeEventListener('mousemove', onMouseMove, false);
                scope.domElement.removeEventListener('mouseup', onMouseUp, false);
                state = STATE.NONE;
            }
            
            function onMouseWheel(event) {
                if (scope.enabled === false || scope.enableZoom === false) return;
                event.preventDefault();
                
                if (event.deltaY < 0) {
                    scale /= 0.95;
                } else if (event.deltaY > 0) {
                    scale *= 0.95;
                }
                scope.update();
            }
            
            scope.domElement.addEventListener('mousedown', onMouseDown, false);
            scope.domElement.addEventListener('wheel', onMouseWheel, false);
            scope.domElement.addEventListener('contextmenu', function (event) { event.preventDefault(); }, false);
            
            this.update();
        };

        // Professional Master Plan 3D - Phase 1
        class ProfessionalMasterPlan3D {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.buildings = [];
                this.lights = {};
                this.currentPhase = 'phase1';
                this.isNightMode = false;
                this.animationId = null;
                this.frameCount = 0;
                this.lastTime = performance.now();
                this.fps = 60;
                
                // Professional building materials
                this.materials = {
                    glass: null,
                    concrete: null,
                    metal: null,
                    brick: null
                };
                
                // Phase data with enhanced information
                this.phases = {
                    phase1: {
                        buildings: ['admin', 'research', 'innovation'],
                        cameraPosition: { x: 80, y: 60, z: 80 },
                        description: 'Foundation Phase - Core Infrastructure'
                    },
                    phase2: {
                        buildings: ['admin', 'research', 'innovation', 'office1', 'office2', 'manufacturing', 'conference'],
                        cameraPosition: { x: 0, y: 80, z: 120 },
                        description: 'Expansion Phase - Technology Districts'
                    },
                    phase3: {
                        buildings: ['admin', 'research', 'innovation', 'office1', 'office2', 'manufacturing', 'conference', 'residential', 'transport', 'energy'],
                        cameraPosition: { x: -60, y: 100, z: 100 },
                        description: 'Integration Phase - Smart City'
                    }
                };

                this.viewPositions = {
                    overview: { x: 80, y: 60, z: 80, target: { x: 0, y: 0, z: 0 } },
                    aerial: { x: 0, y: 180, z: 0, target: { x: 0, y: 0, z: 0 } },
                    ground: { x: 120, y: 20, z: 80, target: { x: 0, y: 20, z: 0 } }
                };
                
                console.log('🏗️ Professional Master Plan 3D initialized');
            }

            async init() {
                try {
                    console.log('🚀 Starting professional initialization...');
                    
                    await this.initThreeJS();
                    await this.createProfessionalMaterials();
                    await this.createEnhancedScene();
                    await this.createProfessionalBuildings();
                    
                    this.setCameraView('overview');
                    this.updatePhaseVisibility('phase1');
                    this.setupEventListeners();
                    this.setupLightingControls();
                    this.startAnimation();
                    
                    this.hideLoading();
                    console.log('✅ Professional Master Plan initialized successfully');
                    
                } catch (error) {
                    console.error('❌ Failed to initialize:', error);
                }
            }

            async initThreeJS() {
                const container = document.getElementById('threejs-container');
                if (!container) throw new Error('Container not found');

                // Scene with enhanced background
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x87ceeb);
                this.scene.fog = new THREE.Fog(0x87ceeb, 150, 400);

                // Professional camera setup
                const aspect = container.clientWidth / container.clientHeight;
                this.camera = new THREE.PerspectiveCamera(60, aspect, 0.1, 1000);
                this.camera.position.set(80, 60, 80);
                this.camera.lookAt(0, 0, 0);

                // Enhanced renderer
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: false,
                    powerPreference: 'high-performance'
                });
                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                this.renderer.outputEncoding = THREE.sRGBEncoding;
                this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
                this.renderer.toneMappingExposure = 1.2;
                
                container.appendChild(this.renderer.domElement);

                // Professional controls
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.minDistance = 30;
                this.controls.maxDistance = 300;
                this.controls.target.set(0, 0, 0);
                this.controls.maxPolarAngle = Math.PI / 2.1;
                
                console.log('🎮 Professional Three.js setup complete');
            }

            async createProfessionalMaterials() {
                // Glass material for modern buildings
                this.materials.glass = new THREE.MeshPhysicalMaterial({
                    color: 0x88ccee,
                    metalness: 0.0,
                    roughness: 0.1,
                    transmission: 0.9,
                    transparent: true,
                    opacity: 0.8,
                    reflectivity: 0.8,
                    ior: 1.5
                });

                // Concrete material for structural buildings
                this.materials.concrete = new THREE.MeshStandardMaterial({
                    color: 0xaaaaaa,
                    metalness: 0.1,
                    roughness: 0.8,
                    normalScale: new THREE.Vector2(0.5, 0.5)
                });

                // Metal material for industrial buildings
                this.materials.metal = new THREE.MeshStandardMaterial({
                    color: 0x666666,
                    metalness: 0.9,
                    roughness: 0.3,
                    envMapIntensity: 1.0
                });

                // Brick material for traditional buildings
                this.materials.brick = new THREE.MeshStandardMaterial({
                    color: 0xcc6666,
                    metalness: 0.0,
                    roughness: 0.9
                });
                
                console.log('🎨 Professional materials created');
            }

            async createEnhancedScene() {
                // Professional lighting setup
                this.createProfessionalLighting();
                
                // Enhanced ground
                const groundGeometry = new THREE.PlaneGeometry(300, 300, 50, 50);
                const groundMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x4ade80,
                    metalness: 0.0,
                    roughness: 0.8
                });
                
                const ground = new THREE.Mesh(groundGeometry, groundMaterial);
                ground.rotation.x = -Math.PI / 2;
                ground.receiveShadow = true;
                this.scene.add(ground);

                // Add environment elements
                this.createEnvironmentElements();
                
                console.log('🌍 Enhanced scene created');
            }

            createProfessionalLighting() {
                // Enhanced ambient light
                this.lights.ambient = new THREE.AmbientLight(0xffffff, 0.8);
                this.scene.add(this.lights.ambient);

                // Professional sun light
                this.lights.sun = new THREE.DirectionalLight(0xffffff, 1.5);
                this.lights.sun.position.set(100, 100, 50);
                this.lights.sun.castShadow = true;
                this.lights.sun.shadow.mapSize.width = 4096;
                this.lights.sun.shadow.mapSize.height = 4096;
                this.lights.sun.shadow.camera.near = 0.5;
                this.lights.sun.shadow.camera.far = 500;
                this.lights.sun.shadow.camera.left = -150;
                this.lights.sun.shadow.camera.right = 150;
                this.lights.sun.shadow.camera.top = 150;
                this.lights.sun.shadow.camera.bottom = -150;
                this.lights.sun.shadow.bias = -0.0001;
                this.scene.add(this.lights.sun);

                // Fill light for better illumination
                this.lights.fill = new THREE.DirectionalLight(0x87ceeb, 0.5);
                this.lights.fill.position.set(-50, 80, -50);
                this.scene.add(this.lights.fill);

                // Hemisphere light for natural sky lighting
                this.lights.sky = new THREE.HemisphereLight(0x87ceeb, 0x4ade80, 0.6);
                this.scene.add(this.lights.sky);
                
                console.log('💡 Professional lighting created');
            }

            createEnvironmentElements() {
                // Add some decorative trees
                const treePositions = [
                    [-100, 0, -100], [100, 0, -100], [-100, 0, 100], [100, 0, 100],
                    [-80, 0, -60], [80, 0, -60], [-80, 0, 60], [80, 0, 60]
                ];

                treePositions.forEach(pos => {
                    const tree = this.createProfessionalTree();
                    tree.position.set(pos[0], pos[1], pos[2]);
                    this.scene.add(tree);
                });

                // Add paths/roads (simple for now)
                this.createPathways();
            }

            createProfessionalTree() {
                const group = new THREE.Group();
                
                // Trunk with better material
                const trunkGeometry = new THREE.CylinderGeometry(1, 1.5, 12, 8);
                const trunkMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x4a4a4a,
                    roughness: 0.9,
                    metalness: 0.0
                });
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                trunk.position.y = 6;
                trunk.castShadow = true;
                group.add(trunk);
                
                // Leaves with better material
                const leavesGeometry = new THREE.SphereGeometry(8, 12, 12);
                const leavesMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x228b22,
                    roughness: 0.8,
                    metalness: 0.0
                });
                const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
                leaves.position.y = 15;
                leaves.castShadow = true;
                leaves.receiveShadow = true;
                group.add(leaves);
                
                return group;
            }

            createPathways() {
                const pathGeometry = new THREE.PlaneGeometry(280, 6);
                const pathMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x555555,
                    roughness: 0.7,
                    metalness: 0.1
                });
                
                // Main road
                const mainRoad = new THREE.Mesh(pathGeometry, pathMaterial);
                mainRoad.rotation.x = -Math.PI / 2;
                mainRoad.position.y = 0.1;
                mainRoad.receiveShadow = true;
                this.scene.add(mainRoad);
                
                // Cross road
                const crossRoad = new THREE.Mesh(pathGeometry, pathMaterial);
                crossRoad.rotation.x = -Math.PI / 2;
                crossRoad.rotation.z = Math.PI / 2;
                crossRoad.position.y = 0.1;
                crossRoad.receiveShadow = true;
                this.scene.add(crossRoad);
            }

            async createProfessionalBuildings() {
                const buildingConfigs = {
                    admin: { 
                        pos: [0, 0, 0], 
                        size: [15, 20, 15], 
                        color: 0x1e3a8a,
                        type: 'glass',
                        name: 'Administration Center'
                    },
                    research: { 
                        pos: [-30, 0, -20], 
                        size: [20, 25, 20], 
                        color: 0x3b82f6,
                        type: 'concrete',
                        name: 'Research & Development'
                    },
                    innovation: { 
                        pos: [30, 0, -20], 
                        size: [18, 22, 18], 
                        color: 0x6366f1,
                        type: 'glass',
                        name: 'Innovation Hub'
                    },
                    office1: { 
                        pos: [-50, 0, 20], 
                        size: [12, 30, 12], 
                        color: 0xfbbf24,
                        type: 'glass',
                        name: 'Office Complex A'
                    },
                    office2: { 
                        pos: [50, 0, 20], 
                        size: [12, 28, 12], 
                        color: 0xf59e0b,
                        type: 'glass',
                        name: 'Office Complex B'
                    },
                    manufacturing: { 
                        pos: [0, 0, 50], 
                        size: [25, 15, 20], 
                        color: 0xd97706,
                        type: 'metal',
                        name: 'Manufacturing Facility'
                    },
                    conference: { 
                        pos: [-25, 0, 40], 
                        size: [20, 12, 15], 
                        color: 0xeab308,
                        type: 'brick',
                        name: 'Conference Center'
                    },
                    residential: { 
                        pos: [40, 0, 60], 
                        size: [15, 35, 15], 
                        color: 0x10b981,
                        type: 'concrete',
                        name: 'Residential Complex'
                    },
                    transport: { 
                        pos: [-40, 0, 70], 
                        size: [30, 8, 12], 
                        color: 0x059669,
                        type: 'metal',
                        name: 'Transport Hub'
                    },
                    energy: { 
                        pos: [20, 0, 80], 
                        size: [10, 40, 10], 
                        color: 0x047857,
                        type: 'metal',
                        name: 'Energy Center'
                    }
                };

                // Create buildings with professional materials
                Object.entries(buildingConfigs).forEach(([id, config]) => {
                    const building = this.createProfessionalBuilding(id, config);
                    this.buildings.push(building);
                    this.scene.add(building);
                });

                console.log(`🏢 Created ${this.buildings.length} professional buildings`);
            }

            createProfessionalBuilding(id, config) {
                const geometry = new THREE.BoxGeometry(config.size[0], config.size[1], config.size[2]);
                
                // Select material based on building type
                let material;
                switch (config.type) {
                    case 'glass':
                        material = this.materials.glass.clone();
                        break;
                    case 'concrete':
                        material = this.materials.concrete.clone();
                        break;
                    case 'metal':
                        material = this.materials.metal.clone();
                        break;
                    case 'brick':
                        material = this.materials.brick.clone();
                        break;
                    default:
                        material = this.materials.concrete.clone();
                }
                
                // Tint the material with the config color
                material.color.setHex(config.color);
                
                const building = new THREE.Mesh(geometry, material);
                building.position.set(config.pos[0], config.size[1]/2, config.pos[2]);
                building.castShadow = true;
                building.receiveShadow = true;
                
                building.userData = { 
                    id, 
                    name: config.name,
                    type: config.type,
                    material: material,
                    originalOpacity: material.opacity || 1.0
                };
                
                return building;
            }

            // Smooth camera transitions with GSAP
            setCameraView(view) {
                const position = this.viewPositions[view];
                if (!position) return;
                
                console.log(`📷 Transitioning to ${view} view`);
                
                // Smooth camera animation using GSAP
                gsap.to(this.camera.position, {
                    duration: 2.5,
                    x: position.x,
                    y: position.y,
                    z: position.z,
                    ease: "power2.inOut"
                });
                
                gsap.to(this.controls.target, {
                    duration: 2.5,
                    x: position.target.x,
                    y: position.target.y,
                    z: position.target.z,
                    ease: "power2.inOut",
                    onUpdate: () => {
                        this.controls.update();
                    }
                });
                
                // Update button states
                document.querySelectorAll('.control-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-view="${view}"]`)?.classList.add('active');
            }

            updatePhaseVisibility(phase) {
                const phaseData = this.phases[phase];
                if (!phaseData) return;
                
                this.currentPhase = phase;
                console.log(`🔄 Switching to ${phaseData.description}`);
                
                this.buildings.forEach(building => {
                    const shouldShow = phaseData.buildings.includes(building.userData.id);
                    const targetOpacity = shouldShow ? building.userData.originalOpacity : 0.15;
                    
                    // Smooth opacity animation with GSAP
                    gsap.to(building.userData.material, {
                        duration: 1.5,
                        opacity: targetOpacity,
                        ease: "power2.inOut"
                    });
                    
                    // Scale animation for emphasis
                    if (shouldShow) {
                        gsap.to(building.scale, {
                            duration: 1.5,
                            x: 1,
                            y: 1,
                            z: 1,
                            ease: "back.out(1.7)"
                        });
                    } else {
                        gsap.to(building.scale, {
                            duration: 1.5,
                            x: 0.95,
                            y: 0.95,
                            z: 0.95,
                            ease: "power2.inOut"
                        });
                    }
                });
            }

            toggleDayNight() {
                this.isNightMode = !this.isNightMode;
                
                if (this.isNightMode) {
                    // Night mode
                    gsap.to(this.lights.sun, { duration: 2, intensity: 0.3 });
                    gsap.to(this.lights.ambient, { duration: 2, intensity: 0.4 });
                    gsap.to(this.scene.background, { duration: 2, r: 0.1, g: 0.1, b: 0.3 });
                    gsap.to(this.scene.fog.color, { duration: 2, r: 0.1, g: 0.1, b: 0.3 });
                    console.log('🌙 Switched to night mode');
                } else {
                    // Day mode
                    gsap.to(this.lights.sun, { duration: 2, intensity: 1.5 });
                    gsap.to(this.lights.ambient, { duration: 2, intensity: 0.8 });
                    gsap.to(this.scene.background, { duration: 2, r: 0.53, g: 0.81, b: 0.92 });
                    gsap.to(this.scene.fog.color, { duration: 2, r: 0.53, g: 0.81, b: 0.92 });
                    console.log('☀️ Switched to day mode');
                }
            }

            setupLightingControls() {
                // Sun intensity control
                document.getElementById('sunIntensity').addEventListener('input', (e) => {
                    this.lights.sun.intensity = parseFloat(e.target.value);
                });

                // Ambient intensity control
                document.getElementById('ambientIntensity').addEventListener('input', (e) => {
                    this.lights.ambient.intensity = parseFloat(e.target.value);
                });

                // Time of day control
                document.getElementById('timeOfDay').addEventListener('input', (e) => {
                    const time = parseFloat(e.target.value);
                    this.setTimeOfDay(time);
                });
            }

            setTimeOfDay(hour) {
                // Calculate sun position based on time
                const angle = (hour - 6) * Math.PI / 12; // 6 AM = 0 degrees
                const intensity = Math.max(0.2, Math.cos(angle) + 0.3);
                
                this.lights.sun.position.x = Math.sin(angle) * 100;
                this.lights.sun.position.y = Math.cos(angle) * 100;
                this.lights.sun.intensity = intensity * 1.5;
                
                // Adjust ambient based on time
                this.lights.ambient.intensity = intensity * 0.8;
            }

            updateFPS() {
                this.frameCount++;
                const currentTime = performance.now();
                
                if (currentTime - this.lastTime >= 1000) {
                    this.fps = Math.round((this.frameCount * 1000) / (currentTime - this.lastTime));
                    this.frameCount = 0;
                    this.lastTime = currentTime;
                    
                    const indicator = document.getElementById('performanceIndicator');
                    if (indicator) {
                        indicator.textContent = `${this.fps} FPS | Professional Mode`;
                        indicator.style.color = this.fps >= 45 ? '#10b981' : this.fps >= 30 ? '#f59e0b' : '#ef4444';
                    }
                }
            }

            startAnimation() {
                const animate = () => {
                    this.animationId = requestAnimationFrame(animate);
                    
                    this.updateFPS();
                    
                    if (this.controls) {
                        this.controls.update();
                    }
                    
                    if (this.renderer && this.scene && this.camera) {
                        this.renderer.render(this.scene, this.camera);
                    }
                };
                
                animate();
                console.log('🎬 Professional animation started');
            }

            setupEventListeners() {
                // Window resize
                window.addEventListener('resize', () => this.handleResize());

                // Timeline interaction
                document.querySelectorAll('.timeline-item').forEach(item => {
                    item.addEventListener('click', () => {
                        document.querySelectorAll('.timeline-item').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        
                        const phase = item.dataset.phase;
                        this.updatePhaseVisibility(phase);
                    });
                });

                // Professional controls
                document.querySelectorAll('.control-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const view = btn.dataset.view;
                        const action = btn.dataset.action;
                        
                        if (view) {
                            this.setCameraView(view);
                        } else if (action === 'auto-rotate') {
                            this.controls.autoRotate = !this.controls.autoRotate;
                            btn.classList.toggle('active');
                            console.log(`🔄 Auto-rotate: ${this.controls.autoRotate}`);
                        } else if (action === 'day-night') {
                            this.toggleDayNight();
                            btn.classList.toggle('active');
                        }
                    });
                });
            }

            handleResize() {
                const container = document.getElementById('threejs-container');
                if (!container || !this.camera || !this.renderer) return;
                
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                this.camera.aspect = width / height;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(width, height);
                
                console.log(`📐 Resized to: ${width}x${height}`);
            }

            hideLoading() {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    gsap.to(overlay, {
                        duration: 1,
                        opacity: 0,
                        onComplete: () => {
                            overlay.style.display = 'none';
                        }
                    });
                }
            }
        }

        // Initialize Professional Master Plan
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('🚀 Starting Professional Master Plan Phase 1...');
            const masterPlan = new ProfessionalMasterPlan3D();
            window.masterPlan = masterPlan; // For debugging
            await masterPlan.init();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Smart City Campus - HEART Data Center</title>
    
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #f0f8ff;
            font-family: Arial, sans-serif;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .control-panel {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            color: white;
            pointer-events: all;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .stats-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            min-width: 200px;
        }

        .control-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
            pointer-events: all;
        }

        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        button.active {
            background: #ef4444;
        }

        h3 {
            margin: 0 0 1rem 0;
            color: #fbbf24;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            color: #10b981;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div class="ui-overlay">
        <div class="control-panel stats-panel">
            <h3>üìä 3D Campus Stats</h3>
            <div class="stat-item">
                <span>Status:</span>
                <span class="stat-value" id="status">Loading...</span>
            </div>
            <div class="stat-item">
                <span>FPS:</span>
                <span class="stat-value" id="fps">0</span>
            </div>
            <div class="stat-item">
                <span>Objects:</span>
                <span class="stat-value" id="objects">0</span>
            </div>
            <div class="stat-item">
                <span>Smart City:</span>
                <span class="stat-value" id="smart-city-status">Disabled</span>
            </div>
        </div>

        <div class="control-buttons">
            <button id="enable-smart-city">üèôÔ∏è Enable Smart City</button>
            <button id="toggle-view">üé• Change View</button>
            <button id="reset-scene">üîÑ Reset Scene</button>
        </div>
    </div>

    <script>
        // Working 3D Campus Implementation
        class WorkingSmartCity3DCampus {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.smartCityEnabled = false;
                this.buildings = [];
                this.trees = [];
                this.smartCityObjects = [];
                this.viewIndex = 0;
                this.views = [
                    { position: [120, 100, 120], name: 'Overview' },
                    { position: [0, 150, 0], name: 'Aerial' },
                    { position: [80, 50, 80], name: 'Ground' }
                ];
                
                this.init();
            }

            init() {
                try {
                    console.log('üöÄ Initializing 3D Campus...');
                    document.getElementById('status').textContent = 'Initializing...';
                    
                    // Initialize Three.js
                    this.initThreeJS();
                    
                    // Create basic scene
                    this.createBasicScene();
                    
                    // Setup controls
                    this.setupControls();
                    
                    // Start render loop
                    this.animate();
                    
                    // Setup event listeners
                    this.setupEventListeners();
                    
                    document.getElementById('status').textContent = 'Running';
                    console.log('‚úÖ 3D Campus initialized successfully');
                    
                } catch (error) {
                    console.error('‚ùå Initialization error:', error);
                    document.getElementById('status').textContent = 'Error: ' + error.message;
                }
            }

            initThreeJS() {
                const container = document.getElementById('canvas-container');
                
                // Scene
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf0f8ff);
                
                // Camera
                this.camera = new THREE.PerspectiveCamera(
                    75, 
                    container.clientWidth / container.clientHeight,
                    0.1,
                    1000
                );
                this.camera.position.set(120, 100, 120);
                this.camera.lookAt(0, 0, 0);
                
                // Renderer
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                container.appendChild(this.renderer.domElement);
                
                // Lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
                this.scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
                directionalLight.position.set(50, 100, 50);
                directionalLight.castShadow = true;
                this.scene.add(directionalLight);
            }

            createBasicScene() {
                console.log('üèóÔ∏è Creating basic scene...');
                
                // Ground plane
                const groundGeometry = new THREE.PlaneGeometry(200, 200);
                const groundMaterial = new THREE.MeshLambertMaterial({ color: 0xf0f0f0 });
                const ground = new THREE.Mesh(groundGeometry, groundMaterial);
                ground.rotation.x = -Math.PI / 2;
                ground.receiveShadow = true;
                this.scene.add(ground);
                
                // Grid
                const gridHelper = new THREE.GridHelper(200, 20, 0x888888, 0xcccccc);
                this.scene.add(gridHelper);
                
                // Create buildings
                this.createBuildings();
                
                // Create trees
                this.createTrees();
                
                this.updateStats();
            }

            createBuildings() {
                const buildingData = [
                    { x: 20, z: 30, color: 0x4a90e2, height: 25 },
                    { x: -40, z: 20, color: 0xe74c3c, height: 35 },
                    { x: 60, z: -30, color: 0xf39c12, height: 20 },
                    { x: -60, z: -40, color: 0x9b59b6, height: 30 },
                    { x: 0, z: 0, color: 0x2ecc71, height: 40 },
                    { x: 40, z: 60, color: 0x34495e, height: 25 },
                    { x: -20, z: -60, color: 0x16a085, height: 28 }
                ];
                
                buildingData.forEach(data => {
                    const geometry = new THREE.BoxGeometry(15, data.height, 15);
                    const material = new THREE.MeshLambertMaterial({ color: data.color });
                    const building = new THREE.Mesh(geometry, material);
                    
                    building.position.set(data.x, data.height / 2, data.z);
                    building.castShadow = true;
                    building.receiveShadow = true;
                    
                    this.scene.add(building);
                    this.buildings.push(building);
                });
            }

            createTrees() {
                const treePositions = [
                    { x: 10, z: 50 }, { x: -30, z: 50 }, { x: 50, z: 10 },
                    { x: -50, z: -20 }, { x: 30, z: -50 }, { x: -10, z: -30 }
                ];
                
                treePositions.forEach(pos => {
                    // Trunk
                    const trunkGeometry = new THREE.CylinderGeometry(1, 1.5, 8);
                    const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8b4513 });
                    const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                    trunk.position.set(pos.x, 4, pos.z);
                    trunk.castShadow = true;
                    this.scene.add(trunk);
                    this.trees.push(trunk);
                    
                    // Leaves
                    const leavesGeometry = new THREE.SphereGeometry(5, 8, 6);
                    const leavesMaterial = new THREE.MeshLambertMaterial({ color: 0x228b22 });
                    const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
                    leaves.position.set(pos.x, 10, pos.z);
                    leaves.castShadow = true;
                    this.scene.add(leaves);
                    this.trees.push(leaves);
                });
            }

            enableSmartCity() {
                if (this.smartCityEnabled) {
                    this.disableSmartCity();
                    return;
                }
                
                console.log('üèôÔ∏è Enabling Smart City...');
                this.smartCityEnabled = true;
                
                // Add roads
                const roadMaterial = new THREE.MeshBasicMaterial({ color: 0x333333 });
                for (let i = -2; i <= 2; i++) {
                    const road = new THREE.Mesh(
                        new THREE.PlaneGeometry(200, 5),
                        roadMaterial
                    );
                    road.rotation.x = -Math.PI / 2;
                    road.position.set(0, 0.1, i * 40);
                    this.scene.add(road);
                    this.smartCityObjects.push(road);
                }
                
                // Add street lights
                for (let x = -80; x <= 80; x += 40) {
                    for (let z = -80; z <= 80; z += 40) {
                        const poleGeometry = new THREE.CylinderGeometry(0.5, 0.5, 15);
                        const poleMaterial = new THREE.MeshLambertMaterial({ color: 0x666666 });
                        const pole = new THREE.Mesh(poleGeometry, poleMaterial);
                        pole.position.set(x, 7.5, z);
                        pole.castShadow = true;
                        this.scene.add(pole);
                        this.smartCityObjects.push(pole);
                        
                        const lightGeometry = new THREE.SphereGeometry(2, 8, 6);
                        const lightMaterial = new THREE.MeshBasicMaterial({ 
                            color: 0xffff00,
                            emissive: 0xffff00,
                            emissiveIntensity: 0.5
                        });
                        const light = new THREE.Mesh(lightGeometry, lightMaterial);
                        light.position.set(x, 14, z);
                        this.scene.add(light);
                        this.smartCityObjects.push(light);
                    }
                }
                
                document.getElementById('smart-city-status').textContent = 'Enabled';
                document.getElementById('enable-smart-city').textContent = 'üèôÔ∏è Disable Smart City';
                document.getElementById('enable-smart-city').classList.add('active');
                
                this.updateStats();
            }

            disableSmartCity() {
                console.log('üèôÔ∏è Disabling Smart City...');
                this.smartCityEnabled = false;
                
                // Remove smart city objects
                this.smartCityObjects.forEach(obj => {
                    this.scene.remove(obj);
                    if (obj.geometry) obj.geometry.dispose();
                    if (obj.material) obj.material.dispose();
                });
                this.smartCityObjects = [];
                
                document.getElementById('smart-city-status').textContent = 'Disabled';
                document.getElementById('enable-smart-city').textContent = 'üèôÔ∏è Enable Smart City';
                document.getElementById('enable-smart-city').classList.remove('active');
                
                this.updateStats();
            }

            setupControls() {
                if (THREE.OrbitControls) {
                    this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                    this.controls.enableDamping = true;
                    this.controls.dampingFactor = 0.05;
                    this.controls.minDistance = 30;
                    this.controls.maxDistance = 300;
                    console.log('‚úÖ OrbitControls initialized');
                }
            }

            setupEventListeners() {
                // Smart City button
                document.getElementById('enable-smart-city').addEventListener('click', () => {
                    this.enableSmartCity();
                });
                
                // View button
                document.getElementById('toggle-view').addEventListener('click', () => {
                    this.viewIndex = (this.viewIndex + 1) % this.views.length;
                    const view = this.views[this.viewIndex];
                    this.camera.position.set(...view.position);
                    this.camera.lookAt(0, 0, 0);
                    console.log(`üì∑ Switched to ${view.name} view`);
                });
                
                // Reset button
                document.getElementById('reset-scene').addEventListener('click', () => {
                    this.disableSmartCity();
                    this.viewIndex = 0;
                    const view = this.views[0];
                    this.camera.position.set(...view.position);
                    this.camera.lookAt(0, 0, 0);
                    console.log('üîÑ Scene reset');
                });
                
                // Window resize
                window.addEventListener('resize', () => {
                    const container = document.getElementById('canvas-container');
                    this.camera.aspect = container.clientWidth / container.clientHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(container.clientWidth, container.clientHeight);
                });
            }

            updateStats() {
                let objectCount = 0;
                this.scene.traverse(() => objectCount++);
                document.getElementById('objects').textContent = objectCount;
            }

            animate() {
                const render = () => {
                    requestAnimationFrame(render);
                    
                    // Update controls
                    if (this.controls) {
                        this.controls.update();
                    }
                    
                    // Simple rotation animation for buildings
                    this.buildings.forEach((building, index) => {
                        building.rotation.y += 0.001 * (index % 2 === 0 ? 1 : -1);
                    });
                    
                    // Render scene
                    this.renderer.render(this.scene, this.camera);
                    
                    // Update FPS
                    const fps = Math.floor(1000 / 16.67); // Approximate
                    document.getElementById('fps').textContent = fps;
                };
                
                render();
            }
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.campus = new WorkingSmartCity3DCampus();
            });
        } else {
            window.campus = new WorkingSmartCity3DCampus();
        }
    </script>
</body>
</html>